<div class="container my-4" *ngIf="result">
    <h2>{{ result.quizTitle }} - Details</h2>
    <div class="container my-3">
        <div class="card p-3 mb-3">
            <h5>Result Summary</h5>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <strong>Score:</strong>
                    {{ result.score }} / {{ result.maximumScore }}
                </li>
                <li class="list-group-item">
                    <strong>Percentage:</strong>
                    {{ result.percentage | number:'1.0-2' }}%
                </li>
                <li class="list-group-item">
                    <strong>Question Count:</strong>
                    {{ result.totalQuestions }}
                </li>
                <li class="list-group-item">
                    <strong>Correct Answered Questions:</strong>
                    {{ result.correctAnswers }}
                </li>
                <li class="list-group-item">
                    <strong>Unanswered Questions:</strong>
                    {{ result.unanswerdQuestion }}
                </li>
                <li class="list-group-item">
                    <strong>Time Taken:</strong>
                    {{ result.timeTakenMin }} min
                </li>
            </ul>
        </div>
    </div>

    <h4>Answers</h4>
    <div
        *ngFor="let a of result.attemptAnswerDtos"
        class="card mb-2"
        [ngClass]="{'border-success': a.isCorrect, 'bg-light': !a.isCorrect}"
    >
        <div class="card-body">
            <p [ngClass]="{'text-success fw-bold': a.isCorrect}">
                <strong>Question:</strong>
                {{ a.questionText }}
            </p>

            <ng-container *ngIf="a.qusetionType === 'FillIn'; else choiceTemplate">
                <div>
                    <strong>User Answer:</strong>
                    <p [ngClass]="{ 'text-success fw-bold': a.fillInAnswer === a.correctFillInAnswer }">
                        {{ a.fillInAnswer || 'â€”' }}
                    </p>
                </div>

                <div>
                    <strong>Correct Answer:</strong>
                    <p class="text-success fw-bold">{{ a.correctFillInAnswer }}</p>
                </div>
            </ng-container>

            <!-- Ako NIJE FillIn (Single/Multiple Choice) -->
            <ng-template #choiceTemplate>
                <div *ngIf="a.userAnswers.length">
                    <strong>User Selected:</strong>
                    <ul>
                        <li *ngFor="let ua of a.userAnswers" [ngClass]="{ 'text-success fw-bold': ua.isCorrect }">
                            {{ ua.optionText }}
                        </li>
                    </ul>
                </div>

                <div *ngIf="a.allAnswers.length">
                    <strong>All Options:</strong>
                    <ul>
                        <li *ngFor="let oa of a.allAnswers" [ngClass]="{ 'text-success fw-bold': oa.isCorrect }">
                            {{ oa.optionText }}
                        </li>
                    </ul>
                </div>
            </ng-template>

            <p>
                <strong>Points:</strong>
                {{ a.awardedPoints }} / {{ a.questionPoints }}
            </p>
        </div>
    </div>
    <h4>Progress</h4>
    <ul>
        <li *ngFor="let p of result.progress">Attempt {{ p.attemptNumber }}: {{ p.score }} points</li>
    </ul>

    <div style="width: 1000px; height: 300px; margin: auto">
        <canvas
            baseChart
            [data]="lineChartData"
            [options]="lineChartOptions"
            chartType="line"
            style="width: 100%; height: 100%"
        ></canvas>
    </div>
</div>
