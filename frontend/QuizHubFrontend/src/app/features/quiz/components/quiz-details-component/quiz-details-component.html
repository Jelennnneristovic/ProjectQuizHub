<!-- Prikaz kviza -->
<div class="container my-4" *ngIf="quizDetails; else loadingTpl">
    <div class="card mb-4">
        <div class="card-body">
            <h4>{{ quizDetails.title }}</h4>
            <p>{{ quizDetails.description }}</p>
            <div class="mb-2">
                <span class="badge bg-light text-dark me-1">Category: {{ quizDetails.categoryName }}</span>
                <span class="badge bg-light text-dark me-1">Difficulty: {{ quizDetails.difficultyLevel }}</span>
                <span class="badge bg-light text-dark me-1">Time: {{ quizDetails.timeLimit }} min</span>
                <span class="badge bg-light text-dark">Questions: {{ quizDetails.questions.length }}</span>
            </div>
        </div>
    </div>

    <!-- Existing Questions -->
    <div *ngFor="let q of quizDetails?.questions" class="card mb-3">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <strong>{{ q.text }}</strong>
                    ({{ q.points }} pts)
                    <span class="badge bg-secondary ms-2">{{ q.questionType }}</span>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-outline-primary" (click)="editQuestion(q)">Edit</button>
                    <button class="btn btn-sm btn-outline-danger" (click)="openDeleteQuestionConfirm(q)">Delete</button>
                </div>
            </div>

            <!-- Answer options -->
            <div *ngIf="q.questionType !== 'FillIn'" class="mt-2">
                <div *ngFor="let a of q.answerOptions" class="d-flex gap-2 align-items-center mb-1">
                    <span [class.text-success]="a.isCorrect">{{ a.text }}</span>
                </div>
            </div>

            <!-- Correct FillIn answer -->
            <div *ngIf="q.questionType === 'FillIn'" class="mt-2">
                <strong>Correct answer:</strong>
                {{ q.correctFillInAnswer }}
            </div>
        </div>
    </div>

    <!-- Add / Edit Question Form -->
    <div class="card mb-4">
        <div class="card-body">
            <h5>{{ editingQuestion ? 'Edit Question' : 'Add New Question' }}</h5>

            <!-- Question Text -->
            <input [(ngModel)]="currentQuestion.text" placeholder="Question text" class="form-control mb-2" />

            <!-- Points -->
            <input type="number" [(ngModel)]="currentQuestion.points" placeholder="Points" class="form-control mb-2" />

            <!-- Question Type -->
            <select
                [disabled]="editingQuestion !== undefined"
                [(ngModel)]="currentQuestion.questionType"
                class="form-select mb-2"
                (change)="onQuestionTypeChange()"
            >
                <option value="SingleChoice">Single Choice</option>
                <option value="MultipleChoice">Multiple Choice</option>
                <option value="TrueFalse">True False</option>
                <option value="FillIn">Fill In</option>
            </select>

            <!-- Fill In Answer -->
            <div *ngIf="currentQuestion.questionType === 'FillIn'" class="mb-2">
                <input
                    [(ngModel)]="currentQuestion.correctFillInAnswer"
                    placeholder="Correct Answer"
                    class="form-control"
                />
            </div>

            <!-- Answer Options -->
            <ng-container *ngIf="currentQuestion.questionType !== 'FillIn'">
                <h6>Answer options</h6>
                <div
                    *ngFor="let opt of currentQuestion.answerOptions; let i = index"
                    class="d-flex gap-2 mb-2 align-items-center"
                >
                    <input [(ngModel)]="opt.text" placeholder="Option text" class="form-control" />
                    <input type="checkbox" [(ngModel)]="opt.isCorrect" />
                    Correct
                    <button
                        *ngIf="!editingQuestion"
                        class="btn btn-sm btn-outline-danger"
                        (click)="removeAnswerOption(i)"
                    >
                        x
                    </button>
                </div>
                <button *ngIf="!editingQuestion" class="btn btn-sm btn-secondary" (click)="addAnswerOption()">
                    + Option
                </button>
            </ng-container>

            <div class="mt-3">
                <button class="btn btn-sm btn-success" (click)="editingQuestion ? updateQuestion() : addQuestion()">
                    {{ editingQuestion ? 'Save Changes' : 'Save Question' }}
                </button>
                <button class="btn btn-sm btn-outline-secondary ms-2" (click)="cancelEditing()">Cancel</button>
            </div>
        </div>
    </div>
</div>

<ng-template #loadingTpl>
    <div class="text-center my-5">
        <div class="spinner-border" role="status" aria-hidden="true"></div>
        <div class="mt-2 text-muted">Loading quiz...</div>
    </div>
</ng-template>

<app-confirm-modal-component
    *ngIf="questionToDelete"
    [title]="'Delete Question'"
    [message]="'Are you sure you want to delete ' + questionToDelete.id + '?'"
    (confirm)="deleteQuestion()"
    (cancel)="cancelDelete()"
></app-confirm-modal-component>
